parameters:
 template: CentOS-7-x86_64-GenericCloud.qcow2
 network: default
 pool: default
 kubernetes_version: '1.15.0'
 kubevirt_version: latest
 cdi_version: latest
 rook_version: latest
 olm_version: latest
 domain: karmalabs.com
 disk_size: 20
 rook_disk_size: 30
 numcpus: 8
 memory: 12288
 nodes: 1
 deploy: true
 emulation: false
 keys: []
 tags: [cnvlab]
 bmo: true
 kubevirt: true
 cdi: true
 rook: true
 istio: true
 knative: true
 kafka: true
 olm: true

{% for node in range(0, nodes) %}
studentnet{{ "%03.d" | format(node+1) }}:
 type: network
 cidr: 192.168.11{{ node + 1 }}.0/24
 dhcp: true
 nat: true
 pxe: 192.168.11{{ node }}.2

student{{ "%03.d" | format(node+1) }}:
 template: {{ template }}  
 pool: {{ pool }}
 numcpus: {{ numcpus }}
 memory: {{ memory }}
 tags: {{ tags }}
 keys: {{ keys }}
 domain: {{ domain }}
 nets:
  - name: {{ network }}
  - name: studentnet{{ "%03.d" | format(node+1) }}
    ip: 192.168.11{{ node + 1 }}.2
    mask: 255.255.255.0
    gateway: 192.168.11{{ node }}.1
 disks:
  - size: {{ disk_size }}
  - size: {{ rook_disk_size }}
 files: 
  - path: /etc/profile.d/helper.sh
    origin: helper.sh
  - env.sh
  - kubernetes.sh
  - path: /etc/yum.repos.d/kubernetes.repo
    origin: kubernetes.repo
  - baremetal.sh
  - cdi.sh
  - olm.sh
  - istio.sh
  - kafka.sh
  - knative.sh
  - kubevirt.sh
  - rook.sh
  - rook.yml
 scripts:
  - requirements.sh
{% if deploy %}
  - deploy.sh
{% endif %}

bmstudent{{ "%03.d" | format(node+1) }}:
 pool: {{ pool }}
 numcpus: 4
 memory: 1024
 nets:
 - name: studentnet{{ "%03.d" | format(node+1) }}
   mac: 00:c2:fc:3b:e{{ node + 1 }}:01
{% endfor %}
